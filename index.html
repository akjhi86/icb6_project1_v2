<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì„œìš¸ ì €ê°€ ì»¤í”¼ ë¸Œëœë“œ ì…ì§€ ë¶„ì„ ëŒ€ì‹œë³´ë“œ</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap"
    rel="stylesheet" />
  <!-- Leaflet (ì§€ë„) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <style>
    :root {
      /* ë‹¤í¬ ëª¨ë“œ (ê¸°ë³¸) */
      --bg: #0d1117;
      --surface: #161b22;
      --surface2: #21262d;
      --border: #30363d;
      --text: #e6edf3;
      --text-sub: #8b949e;
      --accent: #58a6ff;
      --shadow: rgba(0, 0, 0, 0.4);
      --ë”ë²¤í‹°: #FF6B6B;
      --ë§¤ë¨¸ë“œì»¤í”¼: #4ECDC4;
      --ë©”ê°€ì»¤í”¼: #FFE66D;
      --ë¹½ë‹¤ë°©: #A8E6CF;
      --ì»´í¬ì¦ˆì»¤í”¼: #C3A6FF;
      --brand-shadow: none;
    }

    body.light-theme {
      /* ë¼ì´íŠ¸ ëª¨ë“œ */
      --bg: #f6f8fa;
      --surface: #ffffff;
      --surface2: #f3f4f6;
      --border: #d0d7de;
      --text: #1f2328;
      --text-sub: #656d76;
      --accent: #0969da;
      --shadow: rgba(31, 35, 40, 0.08);
      /* ë¼ì´íŠ¸ ëª¨ë“œì—ì„œ í˜•ê´‘ìƒ‰ ì‹œì¸ì„± í™•ë³´ë¥¼ ìœ„í•´ ì±„ë„/ëª…ë„ ì•½ê°„ ì¡°ì • */
      --ë”ë²¤í‹°: #d12d2d;
      --ë§¤ë¨¸ë“œì»¤í”¼: #09a39a;
      --ë©”ê°€ì»¤í”¼: #b18e00;
      --ë¹½ë‹¤ë°©: #2e8b57;
      --ì»´í¬ì¦ˆì»¤í”¼: #8a63d2;
      --brand-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Noto Sans KR', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      /* ê°€ë¡œ ìŠ¤í¬ë¡¤ ë°©ì§€ */
      overflow-x: hidden;
    }

    /* â”€â”€ í—¤ë” â”€â”€ */
    header {
      background: var(--surface);
      background-image: linear-gradient(135deg, var(--surface) 0%, var(--bg) 100%);
      border-bottom: 1px solid var(--border);
      padding: 16px 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 12px;
      position: sticky;
      top: 0;
      z-index: 1000;
      box-shadow: 0 4px 12px var(--shadow);
    }

    header h1 {
      font-size: 1.4rem;
      font-weight: 700;
      background: linear-gradient(90deg, var(--accent), #bc8cff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: var(--brand-shadow);
    }

    header p {
      font-size: 0.8rem;
      color: var(--text-sub);
      margin-top: 2px;
    }

    .header-badges {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .badge {
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 0.72rem;
      font-weight: 500;
      border: 1px solid;
    }

    /* â”€â”€ íƒ­ ë„¤ë¹„ â”€â”€ */
    /* â”€â”€ nav ë˜í¼: íƒ­ ìŠ¤í¬ë¡¤ ì˜ì—­ + ë²„íŠ¼ ê³ ì • â”€â”€ */
    .nav-wrap {
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: stretch;
      position: relative;
    }

    /* íƒ­ ë²„íŠ¼ë“¤ë§Œ ìŠ¤í¬ë¡¤ */
    .nav-tabs {
      display: flex;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
      flex: 1;
      min-width: 0;
      padding-left: 32px;
    }

    .nav-tabs::-webkit-scrollbar {
      display: none;
    }

    nav {
      display: contents;
    }


    /* â”€â”€ ì ìˆ˜ ì„¤ëª… íˆ´íŒ ë²„íŠ¼ â”€â”€ */
    .score-info-btn {
      /* nav-wrap ì•ˆì—ì„œ í•­ìƒ ì˜¤ë¥¸ìª½ì— ê³ ì • */
      flex-shrink: 0;
      align-self: center;
      margin: 0 16px;
      padding: 5px 12px;
      border-radius: 6px;
      border: 1px solid var(--border);
      background: var(--surface2);
      color: var(--text-sub);
      font-size: 0.76rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      white-space: nowrap;
      transition: color .15s, border-color .15s;
      font-family: 'Noto Sans KR', sans-serif;
    }

    .score-info-btn:hover,
    .score-info-btn.active {
      color: var(--accent);
      border-color: var(--accent);
    }

    /* â”€â”€ ë“œë¡­ë‹¤ìš´ íˆ´íŒ íŒ¨ë„ (fixedë¡œ í™”ë©´ ê¸°ì¤€ ìœ„ì¹˜) â”€â”€ */
    .score-tooltip-panel {
      display: none;
      position: fixed;
      right: 16px;
      z-index: 2000;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 18px;
      width: min(700px, calc(100vw - 32px));
      box-shadow: 0 16px 48px rgba(0, 0, 0, .55);
      animation: fadeDown .15s ease;
    }

    @keyframes fadeDown {
      from {
        opacity: 0;
        transform: translateY(-6px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .score-tooltip-panel.open {
      display: block;
    }

    .stp-title {
      font-size: 0.88rem;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 5px;
    }

    .stp-sub {
      font-size: 0.75rem;
      color: var(--text-sub);
      margin-bottom: 14px;
      line-height: 1.6;
    }

    .stp-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(145px, 1fr));
      gap: 10px;
    }

    .stp-card {
      background: var(--surface2);
      border-radius: 8px;
      padding: 12px;
      border-left: 3px solid var(--stp-color, var(--accent));
    }

    .stp-card .stp-name {
      font-size: 0.78rem;
      font-weight: 700;
      color: var(--stp-color, var(--accent));
      margin-bottom: 7px;
    }

    .stp-card .stp-formula {
      font-family: monospace;
      font-size: 0.71rem;
      color: var(--text);
      line-height: 1.65;
      margin-bottom: 7px;
      white-space: pre-line;
    }

    .stp-card .stp-note {
      font-size: 0.68rem;
      color: var(--text-sub);
      line-height: 1.5;
    }

    .tab-btn {
      padding: 14px 22px;
      cursor: pointer;
      font-size: 0.88rem;
      font-weight: 500;
      color: var(--text-sub);
      border: none;
      background: none;
      border-bottom: 2px solid transparent;
      transition: all .2s;
    }

    .tab-btn:hover {
      color: var(--text);
    }

    .tab-btn.active {
      color: var(--accent);
      border-bottom-color: var(--accent);
    }

    /* â”€â”€ ë©”ì¸ ë ˆì´ì•„ì›ƒ â”€â”€ */
    main {
      padding: 20px 24px;
      max-width: 1600px;
      margin: 0 auto;
      /* ë‚´ë¶€ ì½˜í…ì¸ ê°€ ë°”ê¹¥ìœ¼ë¡œ ë‚˜ê°€ì§€ ì•Šë„ë¡ */
      min-width: 0;
    }

    .tab-panel {
      display: none;
    }

    .tab-panel.active {
      display: block;
    }

    /* â”€â”€ ì¹´ë“œ â”€â”€ */
    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      width: 100%;
    }

    .card h3 {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text-sub);
      margin-bottom: 16px;
      text-transform: uppercase;
      letter-spacing: .05em;
    }

    /* â”€â”€ ê°œìš” íƒ­ â”€â”€ */
    .overview-grid {
      display: grid;
      /* ë¸Œë¼ìš´ë“œ ì»¨í…Œì´ë„ˆ ë„ˆë¹„ì— ë§ê²Œ ìë™ ì¡°ì • */
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 14px;
      margin-bottom: 20px;
    }

    .brand-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 18px;
      position: relative;
      overflow: hidden;
      transition: transform .2s, box-shadow .2s;
      cursor: pointer;
    }

    .brand-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, .4);
    }

    .brand-card.selected {
      border-color: var(--accent);
    }

    .brand-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
    }

    .brand-card .brand-name {
      font-size: 1.1rem;
      font-weight: 700;
      margin-bottom: 12px;
      text-shadow: var(--brand-shadow);
    }

    .brand-card .stat {
      margin-bottom: 6px;
    }

    .brand-card .stat-val {
      font-size: 1.5rem;
      font-weight: 900;
    }

    .brand-card .stat-label {
      font-size: 0.72rem;
      color: var(--text-sub);
    }

    .charts-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin-bottom: 20px;
      /* ê° ì¹´ë“œê°€ ìµœì†Œ ë„ˆë¹„ë¥¼ ìœ ì§€í•˜ë„ë¡ */
      min-width: 0;
    }

    .charts-row>* {
      min-width: 0;
    }

    .chart-wrap {
      position: relative;
      height: 280px;
    }

    /* â”€â”€ ì§€ë„ íƒ­ â”€â”€ */
    .map-layout {
      display: grid;
      grid-template-columns: 260px 1fr;
      gap: 16px;
      height: calc(100vh - 180px);
      min-height: 400px;
    }

    .map-sidebar {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      overflow-y: auto;
    }

    .map-sidebar h3 {
      font-size: 0.85rem;
      color: var(--text-sub);
      margin-bottom: 12px;
    }

    #map {
      border-radius: 12px;
      border: 1px solid var(--border);
      height: 100%;
    }

    .brand-filter-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      margin-bottom: 6px;
      border: 1px solid var(--border);
      background: var(--surface2);
      color: var(--text);
      font-size: 0.82rem;
      transition: all .15s;
      width: 100%;
    }

    .brand-filter-btn.active {
      border-color: currentColor;
      background: var(--surface);
      box-shadow: 0 2px 8px var(--shadow);
    }

    .brand-filter-btn .dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .brand-filter-btn .count {
      margin-left: auto;
      font-size: 0.75rem;
      color: var(--text-sub);
    }

    /* â”€â”€ í–‰ì •ë™ ë¶„ì„ íƒ­ â”€â”€ */
    .dong-layout {
      display: grid;
      grid-template-columns: 1fr 360px;
      gap: 16px;
      /* ìë…€ ìš”ì†Œê°€ ë°”ê¹¥ìœ¼ë¡œ ë‚˜ê°€ì§€ ì•Šë„ë¡ */
      min-width: 0;
    }

    .dong-layout>* {
      min-width: 0;
    }

    .dong-table-wrap {
      overflow-x: auto;
      /* í…Œì´ë¸”ì´ ë„ˆë¬´ ë„“ìœ¼ë©´ ë‚´ë¶€ ìŠ¤í¬ë¡¤ë§Œ ìƒê¹€ */
      -webkit-overflow-scrolling: touch;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.82rem;
    }

    th {
      background: var(--surface2);
      padding: 10px 12px;
      text-align: left;
      font-weight: 600;
      color: var(--text-sub);
      border-bottom: 1px solid var(--border);
      cursor: pointer;
      white-space: nowrap;
      user-select: none;
    }

    th:hover {
      color: var(--text);
    }

    td {
      padding: 9px 12px;
      border-bottom: 1px solid rgba(48, 54, 61, .5);
    }

    tr:hover td {
      background: var(--surface2);
    }

    .brand-pill {
      display: inline-block;
      padding: 2px 7px;
      border-radius: 10px;
      font-size: 0.7rem;
      font-weight: 600;
      margin: 1px;
    }

    .score-bar {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .score-bar-inner {
      height: 6px;
      border-radius: 3px;
      background: var(--accent);
      flex-shrink: 0;
    }

    /* â”€â”€ ì…ì§€ ì¶”ì²œ íƒ­ â”€â”€ */
    .recommend-filters {
      display: flex;
      gap: 10px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }

    .filter-select {
      background: var(--surface2);
      border: 1px solid var(--border);
      color: var(--text);
      padding: 7px 12px;
      border-radius: 8px;
      font-size: 0.82rem;
      cursor: pointer;
    }

    .recommend-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 12px;
    }

    .rec-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 16px;
      transition: transform .15s;
    }

    .rec-card:hover {
      transform: translateY(-2px);
    }

    .rec-card .rec-rank {
      font-size: 0.7rem;
      color: var(--text-sub);
      margin-bottom: 6px;
    }

    .rec-card .rec-dong {
      font-size: 1rem;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .rec-card .rec-brand {
      font-size: 0.8rem;
      margin-bottom: 12px;
    }

    .rec-card .rec-scores {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }

    .rec-score-item {
      background: var(--surface2);
      border-radius: 6px;
      padding: 8px;
    }

    .rec-score-item .label {
      font-size: 0.68rem;
      color: var(--text-sub);
      margin-bottom: 2px;
    }

    .rec-score-item .value {
      font-size: 1rem;
      font-weight: 700;
    }

    /* â”€â”€ ê³µí†µ ìœ í‹¸ â”€â”€ */
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 300px;
      color: var(--text-sub);
      font-size: 0.9rem;
    }

    .search-input {
      background: var(--surface2);
      border: 1px solid var(--border);
      color: var(--text);
      padding: 8px 14px;
      border-radius: 8px;
      font-size: 0.85rem;
      /* ê³ ì • ë„ˆë¹„ ì œê±° â†’ ë°˜ì‘í˜• */
      width: 100%;
      max-width: 240px;
    }

    .search-input:focus {
      outline: none;
      border-color: var(--accent);
    }

    .toolbar {
      display: flex;
      gap: 10px;
      margin-bottom: 14px;
      align-items: center;
      flex-wrap: wrap;
    }

    /* â”€â”€ ì ìˆ˜ ì„¤ëª… ì„¹ì…˜ â”€â”€ */
    .score-guide {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 14px;
      margin-top: 16px;
    }

    .score-guide-card {
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 16px;
      position: relative;
      overflow: hidden;
    }

    .score-guide-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: var(--sg-color, var(--accent));
    }

    .score-guide-card .sg-title {
      font-size: 0.85rem;
      font-weight: 700;
      color: var(--sg-color, var(--accent));
      margin-bottom: 10px;
    }

    .score-guide-card .sg-formula {
      background: var(--surface);
      border-radius: 6px;
      padding: 8px 10px;
      font-size: 0.75rem;
      font-family: monospace;
      color: var(--text);
      margin-bottom: 10px;
      line-height: 1.7;
      white-space: pre-line;
    }

    .score-guide-card .sg-desc {
      font-size: 0.75rem;
      color: var(--text-sub);
      line-height: 1.7;
    }

    .score-guide-card .sg-source {
      margin-top: 10px;
      padding-top: 8px;
      border-top: 1px solid var(--border);
      font-size: 0.7rem;
      color: var(--text-sub);
    }

    .score-guide-card .sg-source span {
      display: inline-block;
      background: var(--surface);
      border-radius: 4px;
      padding: 1px 6px;
      margin: 2px 2px 0 0;
    }


    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       ë°˜ì‘í˜• ë¯¸ë””ì–´ ì¿¼ë¦¬ â”€ 1100px ì´í•˜ (íƒœë¸”ë¦¿)
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @media (max-width: 1100px) {
      .charts-row {
        grid-template-columns: 1fr;
      }

      .dong-layout {
        grid-template-columns: 1fr;
      }

      .map-layout {
        grid-template-columns: 1fr;
        grid-template-rows: auto 1fr;
        height: auto;
      }

      .map-sidebar {
        /* ì‚¬ì´ë“œë°”ê°€ ìœ„ë¡œ ì˜¬ë¼ì˜¤ë©´ ê°€ë¡œ ìŠ¤í¬ë¡¤ ì—†ì´ í¼ì³ì§ */
        max-height: 220px;
      }

      #map {
        height: 50vh;
        min-height: 300px;
      }
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       ë°˜ì‘í˜• ë¯¸ë””ì–´ ì¿¼ë¦¬ â”€ 768px ì´í•˜ (ëª¨ë°”ì¼ ê°€ë¡œ)
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @media (max-width: 768px) {
      main {
        padding: 14px 16px;
      }

      header {
        padding: 12px 16px;
      }

      header h1 {
        font-size: 1.1rem;
      }

      /* íƒ­ ë„¤ë¹„ê°€ ìŠ¤í¬ë¡¤ ì—†ì´ ì „ì²´ í‘œì‹œ */
      nav {
        padding: 0 12px;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
      }

      nav::-webkit-scrollbar {
        display: none;
      }

      .tab-btn {
        padding: 12px 14px;
        font-size: 0.8rem;
        white-space: nowrap;
        flex-shrink: 0;
      }

      .overview-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .recommend-grid {
        grid-template-columns: 1fr;
      }

      .toolbar {
        flex-direction: column;
        align-items: stretch;
      }

      .search-input {
        max-width: 100%;
      }

      .filter-select {
        width: 100%;
      }
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       ë°˜ì‘í˜• ë¯¸ë””ì–´ ì¿¼ë¦¬ â”€ 480px ì´í•˜ (ëª¨ë°”ì¼ ì„¸ë¡œ)
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @media (max-width: 480px) {
      .overview-grid {
        grid-template-columns: 1fr;
      }

      .brand-card .stat-val {
        font-size: 1.2rem;
      }

      .chart-wrap {
        height: 220px;
      }

      .header-badges {
        display: none;
      }
    }
  </style>
</head>

<body>

  <!-- â”€â”€ í—¤ë” â”€â”€ -->
  <header>
    <div>
      <h1>â˜• ì„œìš¸ ì €ê°€ ì»¤í”¼ ë¸Œëœë“œ ì…ì§€ ë¶„ì„</h1>
      <p>í–‰ì •ë™ë³„ ë¸Œëœë“œ í˜„í™© Â· ë§¤ì¶œ ë¶„ì„ Â· ì…ì§€ ì¶”ì²œ</p>
    </div>
    <div style="display: flex; align-items: center; gap: 12px;">
      <button id="themeToggle" class="badge"
        style="cursor: pointer; background: var(--surface2); border-color: var(--border); color: var(--text);">
        ğŸŒ™ ë‹¤í¬ ëª¨ë“œ
      </button>
      <div class="header-badges" id="headerBadges"></div>
    </div>
  </header>

  <!-- â”€â”€ íƒ­ ë„¤ë¹„ â”€â”€ -->
  <div class="nav-wrap">
    <nav>
      <div class="nav-tabs">
        <button class="tab-btn active" data-tab="overview">ğŸ“Š ë¸Œëœë“œ ê°œìš”</button>
        <button class="tab-btn" data-tab="map">ğŸ—ºï¸ ì§€ë„</button>
        <button class="tab-btn" data-tab="dong">ğŸ™ï¸ í–‰ì •ë™ ë¶„ì„</button>
        <button class="tab-btn" data-tab="recommend">â­ ì…ì§€ ì¶”ì²œ</button>
      </div>
    </nav>

    <!-- í•­ìƒ ì˜¤ë¥¸ìª½ì— ê³ ì •ë˜ëŠ” íˆ´íŒ ë²„íŠ¼ -->
    <button class="score-info-btn" id="scoreInfoBtn">â“ ì ìˆ˜ ê³„ì‚° ë°©ë²•</button>

    <!-- ë“œë¡­ë‹¤ìš´ íˆ´íŒ íŒ¨ë„ -->
    <div class="score-tooltip-panel" id="scoreTooltipPanel">
      <div class="stp-title">ğŸ“ í‰ê°€ ì§€ìˆ˜ ê³„ì‚° ë°©ë²•</div>
      <div class="stp-sub">
        ì„œìš¸ í–‰ì •ë™ë³„ ë°ì´í„°ë¥¼ <strong style="color:var(--text)">Min-Max ì •ê·œí™”(0~1)</strong>í•œ í›„,
        ìˆ˜ìš” Â· ê²½ìŸ Â· ë¹„ìš© ì ìˆ˜ë¥¼ ê°€ì¤‘ í•©ì‚°í•˜ì—¬ ì¢…í•© ë§¤ë ¥ë„ ì§€ìˆ˜ë¥¼ ì‚°ì¶œí•©ë‹ˆë‹¤.
      </div>
      <div class="stp-grid">
        <div class="stp-card" style="--stp-color:#4ECDC4">
          <div class="stp-name">ğŸ“ˆ ìˆ˜ìš” ì ìˆ˜</div>
          <div class="stp-formula">(ì •ê·œí™”_ë§¤ì¶œ Ã— 0.5
            + ì •ê·œí™”_ì¢…ì‚¬ì Ã— 0.5)
            Ã— 100</div>
          <div class="stp-note">ì›”ë§¤ì¶œ + ì¢…ì‚¬ììˆ˜ë¥¼ ë™ë“± ë°˜ì˜. ë†’ì„ìˆ˜ë¡ â†‘</div>
        </div>
        <div class="stp-card" style="--stp-color:#FFE66D">
          <div class="stp-name">âš”ï¸ ê²½ìŸ ì ìˆ˜</div>
          <div class="stp-formula">(1 âˆ’ ì •ê·œí™”_ì¹´í˜ìˆ˜)
            Ã— 100</div>
          <div class="stp-note">ì¹´í˜ ìˆ˜ ì ì„ìˆ˜ë¡ â†‘ (ë°˜ë¹„ë¡€)</div>
        </div>
        <div class="stp-card" style="--stp-color:#A8E6CF">
          <div class="stp-name">ğŸ’° ë¹„ìš© ì ìˆ˜</div>
          <div class="stp-formula">(1 âˆ’ ì •ê·œí™”_ë¶€ë™ì‚°ê°€)
            Ã— 100</div>
          <div class="stp-note">mÂ² ë‹¹ ë¶€ë™ì‚°ê°€ ë‚®ì„ìˆ˜ë¡ â†‘ (ë°˜ë¹„ë¡€)</div>
        </div>
        <div class="stp-card" style="--stp-color:#58a6ff">
          <div class="stp-name">â­ ì¢…í•© ë§¤ë ¥ë„</div>
          <div class="stp-formula">ìˆ˜ìš” Ã— 0.4
            + ê²½ìŸ Ã— 0.3
            + ë¹„ìš© Ã— 0.3</div>
          <div class="stp-note">ìœ ë™ì¸êµ¬ ë§ê³  Â· ê²½ìŸ ì ê³  Â· ì„ëŒ€ë£Œ ì €ë ´í• ìˆ˜ë¡ â†‘</div>
        </div>
      </div>
    </div>
  </div>


  <main>
    <!-- â”€â”€ íƒ­ 1: ë¸Œëœë“œ ê°œìš” â”€â”€ -->
    <div class="tab-panel active" id="tab-overview">
      <div class="overview-grid" id="brandCards"></div>
      <div class="charts-row">
        <div class="card">
          <h3>ë¸Œëœë“œë³„ ë§¤ì¥ ìˆ˜</h3>
          <div class="chart-wrap"><canvas id="chartBrandCount"></canvas></div>
        </div>
        <div class="card">
          <h3>ë¸Œëœë“œë³„ ì§„ì¶œ í–‰ì •ë™ ìˆ˜</h3>
          <div class="chart-wrap"><canvas id="chartDongCount"></canvas></div>
        </div>
      </div>
      <div class="charts-row">
        <div class="card">
          <h3>í–‰ì •ë™ë³„ ë¸Œëœë“œ ë¶„í¬ (ìƒìœ„ 30ê°œ ë™)</h3>
          <div class="chart-wrap" style="height:320px"><canvas id="chartTopDong"></canvas></div>
        </div>
        <div class="card">
          <h3>ì—°ë ¹ëŒ€ë³„ ë§¤ì¶œ êµ¬ì„±</h3>
          <div class="chart-wrap"><canvas id="chartAge"></canvas></div>
        </div>
      </div>

      <!-- â”€â”€ ì ìˆ˜ ê³„ì‚° ë°©ë²• ì„¤ëª… â”€â”€ -->
      <div class="card" style="margin-top:20px">
        <h3>ğŸ“ í‰ê°€ ì§€ìˆ˜ ê³„ì‚° ë°©ë²•</h3>
        <p style="font-size:.8rem;color:var(--text-sub);margin-bottom:16px;line-height:1.7">
          ì„œìš¸ í–‰ì •ë™ë³„ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ì—¬ <strong style="color:var(--text)">Min-Max ì •ê·œí™”(0~1)</strong>ë¥¼ ì ìš©í•œ í›„,
          ìˆ˜ìš” Â· ê²½ìŸ Â· ë¹„ìš© 3ê°€ì§€ ì ìˆ˜ë¥¼ ê°€ì¤‘ í•©ì‚°í•˜ì—¬ ì¢…í•© ë§¤ë ¥ë„ ì§€ìˆ˜ë¥¼ ì‚°ì¶œí•©ë‹ˆë‹¤.
        </p>
        <div class="score-guide">

          <div class="score-guide-card" style="--sg-color:#4ECDC4">
            <div class="sg-title">ğŸ“ˆ ìˆ˜ìš” ì ìˆ˜</div>
            <div class="sg-formula">ìˆ˜ìš” = (ì •ê·œí™”_ë§¤ì¶œ Ã— 0.5
              + ì •ê·œí™”_ì¢…ì‚¬ììˆ˜ Ã— 0.5) Ã— 100</div>
            <div class="sg-desc">
              ì›” ë§¤ì¶œê³¼ ì¢…ì‚¬ì(ìœ ë™ì¸êµ¬)ë¥¼ ë™ë“±í•˜ê²Œ ë°˜ì˜í•©ë‹ˆë‹¤.
              ë‘ ì§€í‘œê°€ ëª¨ë‘ ë†’ì„ìˆ˜ë¡ ì ìˆ˜ê°€ ì˜¬ë¼ê°‘ë‹ˆë‹¤.
            </div>
            <div class="sg-source">ë°ì´í„° ì†ŒìŠ¤:
              <span>ì›” ë§¤ì¶œ ê¸ˆì•¡</span>
              <span>2024 ì´ ì¢…ì‚¬ììˆ˜</span>
            </div>
          </div>

          <div class="score-guide-card" style="--sg-color:#FFE66D">
            <div class="sg-title">âš”ï¸ ê²½ìŸ ì ìˆ˜</div>
            <div class="sg-formula">ê²½ìŸ = (1 âˆ’ ì •ê·œí™”_ì¹´í˜ìˆ˜) Ã— 100</div>
            <div class="sg-desc">
              í•´ë‹¹ í–‰ì •ë™ì˜ ì „ì²´ ì¹´í˜ ìˆ˜ê°€ ì ì„ìˆ˜ë¡
              ê²½ìŸì´ ë‚®ì•„ ì ìˆ˜ê°€ ë†’ì•„ì§‘ë‹ˆë‹¤. (ë°˜ë¹„ë¡€)
            </div>
            <div class="sg-source">ë°ì´í„° ì†ŒìŠ¤:
              <span>ì „ì²´ ì¹´í˜ ìˆ˜</span>
            </div>
          </div>

          <div class="score-guide-card" style="--sg-color:#A8E6CF">
            <div class="sg-title">ğŸ’° ë¹„ìš© ì ìˆ˜</div>
            <div class="sg-formula">ë¹„ìš© = (1 âˆ’ ì •ê·œí™”_ë¶€ë™ì‚°ê°€ê²©) Ã— 100</div>
            <div class="sg-desc">
              mÂ² ë‹¹ í‰ê·  ë¶€ë™ì‚° ê±°ë˜ê°€ê²©ì´ ë‚®ì„ìˆ˜ë¡
              ì„ëŒ€ë£Œ ë¶€ë‹´ì´ ì ì–´ ì ìˆ˜ê°€ ë†’ì•„ì§‘ë‹ˆë‹¤. (ë°˜ë¹„ë¡€)
            </div>
            <div class="sg-source">ë°ì´í„° ì†ŒìŠ¤:
              <span>ë¶€ë™ì‚° ì‹¤ê±°ë˜ê°€</span>
              <span>ì „ìš©ë©´ì (mÂ²)</span>
            </div>
          </div>

          <div class="score-guide-card" style="--sg-color:#58a6ff">
            <div class="sg-title">â­ ì¢…í•© ë§¤ë ¥ë„ ì§€ìˆ˜</div>
            <div class="sg-formula">ë§¤ë ¥ë„ = ìˆ˜ìš” Ã— 0.4
              + ê²½ìŸ Ã— 0.3
              + ë¹„ìš© Ã— 0.3</div>
            <div class="sg-desc">
              ìˆ˜ìš” 40% + ê²½ìŸ 30% + ë¹„ìš© 30% ê°€ì¤‘ì¹˜ë¡œ í•©ì‚°í•œ
              <strong style="color:var(--text)">ì¢…í•© ì…ì§€ ì§€ìˆ˜(0~100ì )</strong>ì…ë‹ˆë‹¤.
              ì ìˆ˜ê°€ ë†’ì„ìˆ˜ë¡ "ìœ ë™ì¸êµ¬ëŠ” ë§ê³ , ê²½ìŸì€ ì ê³ , ì„ëŒ€ë£ŒëŠ” ì €ë ´í•œ" ì…ì§€ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.
            </div>
            <div class="sg-source">ì •ê·œí™” ë°©ì‹:
              <span>Min-Max (0~1)</span>
            </div>
          </div>

        </div>
      </div>
    </div>


    <!-- â”€â”€ íƒ­ 2: ì§€ë„ â”€â”€ -->
    <div class="tab-panel" id="tab-map">
      <div class="map-layout">
        <div class="map-sidebar">
          <h3>ë¸Œëœë“œ í•„í„°</h3>
          <div id="brandFilters"></div>
          <hr style="border-color:var(--border);margin:14px 0">
          <h3>ë²”ë¡€</h3>
          <p style="font-size:.75rem;color:var(--text-sub);line-height:1.6">
            ì§€ë„ì—ì„œ ë§ˆì»¤ë¥¼ í´ë¦­í•˜ë©´ ë§¤ì¥ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
          </p>
          <hr style="border-color:var(--border);margin:14px 0">
          <div id="mapStats" style="font-size:.8rem;color:var(--text-sub)"></div>
        </div>
        <div id="map"></div>
      </div>
    </div>

    <!-- â”€â”€ íƒ­ 3: í–‰ì •ë™ ë¶„ì„ â”€â”€ -->
    <div class="tab-panel" id="tab-dong">
      <div class="dong-layout">
        <div class="card">
          <div class="toolbar">
            <input class="search-input" id="dongSearch" placeholder="ğŸ” í–‰ì •ë™ ê²€ìƒ‰..." />
            <select class="filter-select" id="dongBrandFilter">
              <option value="">ì „ì²´ ë¸Œëœë“œ</option>
            </select>
            <select class="filter-select" id="dongSortBy">
              <option value="total_brand_count">ì´ ë¸Œëœë“œ ìˆ˜</option>
              <option value="attractiveness_score">ë§¤ë ¥ë„ ì ìˆ˜</option>
              <option value="monthly_sales">ì›” ë§¤ì¶œ</option>
              <option value="total_workers">ê·¼ë¡œì ìˆ˜</option>
            </select>
          </div>
          <div class="dong-table-wrap">
            <table id="dongTable">
              <thead>
                <tr>
                  <th>í–‰ì •ë™</th>
                  <th>ë”ë²¤í‹°</th>
                  <th>ë§¤ë¨¸ë“œ</th>
                  <th>ë©”ê°€</th>
                  <th>ë¹½ë‹¤ë°©</th>
                  <th>ì»´í¬ì¦ˆ</th>
                  <th>í•©ê³„</th>
                  <th>ë§¤ë ¥ë„</th>
                  <th>ì›”ë§¤ì¶œ(ì–µ)</th>
                  <th>í‰ê· ë§¤ì¶œ(ë§Œ)</th>
                </tr>
              </thead>
              <tbody id="dongTableBody"></tbody>
            </table>
          </div>
        </div>
        <div>
          <div class="card" id="dongDetail" style="margin-bottom:14px">
            <h3>í–‰ì •ë™ ìƒì„¸</h3>
            <p style="color:var(--text-sub);font-size:.82rem">í…Œì´ë¸”ì—ì„œ í–‰ì„ í´ë¦­í•˜ì„¸ìš”</p>
          </div>
          <div class="card">
            <h3>ì„ íƒ ë™ ì—°ë ¹ëŒ€ë³„ ë§¤ì¶œ</h3>
            <div class="chart-wrap" style="height:220px"><canvas id="chartDongAge"></canvas></div>
          </div>
        </div>
      </div>
    </div>

    <!-- â”€â”€ íƒ­ 4: ì…ì§€ ì¶”ì²œ â”€â”€ -->
    <div class="tab-panel" id="tab-recommend">
      <div class="recommend-filters">
        <select class="filter-select" id="recBrandFilter">
          <option value="">ì „ì²´ ë¸Œëœë“œ</option>
        </select>
        <select class="filter-select" id="recSortFilter">
          <option value="attractiveness_score">ë§¤ë ¥ë„ ì ìˆ˜ ìˆœ</option>
          <option value="demand_score">ìˆ˜ìš” ì ìˆ˜ ìˆœ</option>
          <option value="cost_score">ë¹„ìš© ì ìˆ˜ ìˆœ</option>
        </select>
        <input class="search-input" id="recSearch" placeholder="ğŸ” í–‰ì •ë™ ê²€ìƒ‰..." />
        <span style="color:var(--text-sub);font-size:.82rem;margin-left:auto" id="recCount"></span>
      </div>
      <div class="recommend-grid" id="recommendGrid"></div>
    </div>
  </main>

  <script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  í…Œë§ˆ ì „í™˜ ë¡œì§
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const themeToggle = document.getElementById('themeToggle');
    const body = document.body;

    // ì €ì¥ëœ í…Œë§ˆ ë¶ˆëŸ¬ì˜¤ê¸°
    const savedTheme = localStorage.getItem('theme') || 'dark';
    if (savedTheme === 'light') {
      body.classList.add('light-theme');
      themeToggle.innerText = 'ğŸŒ ë¼ì´íŠ¸ ëª¨ë“œ';
    }

    themeToggle.addEventListener('click', () => {
      const isLight = body.classList.toggle('light-theme');
      const theme = isLight ? 'light' : 'dark';
      localStorage.setItem('theme', theme);
      themeToggle.innerText = isLight ? 'ğŸŒ ë¼ì´íŠ¸ ëª¨ë“œ' : 'ğŸŒ™ ë‹¤í¬ ëª¨ë“œ';

      // ì°¨íŠ¸ ìƒ‰ìƒ ì—…ë°ì´íŠ¸
      updateChartColors(isLight);
    });

    function updateChartColors(isLight) {
      const textColor = isLight ? '#1f2328' : '#e6edf3';
      const gridColor = isLight ? '#d0d7de' : '#30363d';

      // Chart.js ê¸€ë¡œë²Œ ì„¤ì • ì—…ë°ì´íŠ¸ (ê¸°ì¡´ ì°¨íŠ¸ëŠ” ìˆ˜ë™ ì—…ë°ì´íŠ¸ í•„ìš”)
      if (window.Chart) {
        Chart.defaults.color = textColor;
        Chart.defaults.borderColor = gridColor;
        // í˜ì´ì§€ ì „ì²´ ì°¨íŠ¸ ì¸ìŠ¤í„´ìŠ¤ ìˆœíšŒí•˜ë©° ì—…ë°ì´íŠ¸ (í•„ìš” ì‹œ)
      }

      // ì´ë¯¸ ìƒì„±ëœ ì°¨íŠ¸ë“¤ì€ ë‹¤ì‹œ ë¡œë“œ ì‹œ ë°˜ì˜ë˜ì§€ë§Œ, 
      // ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•´ re-init í˜¹ì€ update í˜¸ì¶œì´ í•„ìš”í•©ë‹ˆë‹¤.
      if (DATA) init();
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  ì ìˆ˜ ì„¤ëª… íˆ´íŒ í† ê¸€
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const scoreInfoBtn = document.getElementById('scoreInfoBtn');
    const scoreTooltipPanel = document.getElementById('scoreTooltipPanel');

    scoreInfoBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      const isOpen = scoreTooltipPanel.classList.toggle('open');
      scoreInfoBtn.classList.toggle('active', isOpen);
      if (isOpen) {
        // ë²„íŠ¼ ë°”ë¡œ ì•„ë˜ì— íŒ¨ë„ ìœ„ì¹˜ ê³„ì‚° (fixed ê¸°ì¤€)
        const rect = scoreInfoBtn.getBoundingClientRect();
        scoreTooltipPanel.style.top = (rect.bottom + 6) + 'px';
      }
    });

    // íŒ¨ë„ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
    document.addEventListener('click', (e) => {
      if (!scoreTooltipPanel.contains(e.target) && e.target !== scoreInfoBtn) {
        scoreTooltipPanel.classList.remove('open');
        scoreInfoBtn.classList.remove('active');
      }
    });


    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  ë°ì´í„° ë¡œë“œ ë° ì´ˆê¸°í™”
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    let DATA = null;
    let leafletMap = null;
    let markerLayers = {};
    let activeFilters = new Set();
    let dongAgeChart = null;


    async function loadData() {
      const res = await fetch('dashboard_data.json');
      DATA = await res.json();
      init();
    }

    function init() {
      setupTabs();
      renderHeader();
      renderBrandCards();
      renderOverviewCharts();
      renderDongTable();
      renderRecommend();
      setupBrandFilters();
      // ì§€ë„ëŠ” íƒ­ ì „í™˜ ì‹œ ì´ˆê¸°í™”
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  íƒ­ ì „í™˜
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function setupTabs() {
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
          document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
          btn.classList.add('active');
          const panel = document.getElementById('tab-' + btn.dataset.tab);
          panel.classList.add('active');
          if (btn.dataset.tab === 'map' && !leafletMap) initMap();
        });
      });
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  í—¤ë” ë°°ì§€
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function renderHeader() {
      const total = DATA.map_points.length;
      const dongs = DATA.dong_data.length;
      const html = `
    <span class="badge" style="color:#58a6ff;border-color:#58a6ff30;background:#58a6ff10">
      ğŸ™ï¸ ${dongs}ê°œ í–‰ì •ë™
    </span>
    <span class="badge" style="color:#bc8cff;border-color:#bc8cff30;background:#bc8cff10">
      â˜• ${total.toLocaleString()}ê°œ ë§¤ì¥
    </span>
  `;
      document.getElementById('headerBadges').innerHTML = html;
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  ë¸Œëœë“œ ì¹´ë“œ (ê°œìš” íƒ­)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function renderBrandCards() {
      const container = document.getElementById('brandCards');
      container.innerHTML = DATA.brands.map(brand => {
        const s = DATA.brand_stats[brand];
        const color = DATA.brand_colors[brand];
        // ì í¬ë‹¹ í‰ê·  ì›”ë§¤ì¶œ (ë§Œì› ë‹¨ìœ„)
        const avgStr = s.avg_monthly_sales ? s.avg_monthly_sales.toLocaleString() + 'ë§Œ' : '-';
        return `
      <div class="brand-card" style="--brand-color:${color}">
        <div style="position:absolute;top:0;left:0;right:0;height:3px;background:${color};border-radius:12px 12px 0 0"></div>
        <div class="brand-name" style="color:${color}">${brand}</div>
        <div class="stat">
          <div class="stat-val">${s.total_stores.toLocaleString()}</div>
          <div class="stat-label">ì´ ë§¤ì¥ ìˆ˜</div>
        </div>
        <div class="stat" style="margin-top:8px">
          <div class="stat-val" style="font-size:1.1rem">${s.dong_count}</div>
          <div class="stat-label">ì§„ì¶œ í–‰ì •ë™</div>
        </div>
        <div class="stat" style="margin-top:8px">
          <div class="stat-val" style="font-size:1.1rem;color:${color}">${avgStr}</div>
          <div class="stat-label">ì í¬ë‹¹ í‰ê· ì›”ë§¤ì¶œ</div>
        </div>
      </div>
    `;
      }).join('');
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  ê°œìš” ì°¨íŠ¸ë“¤
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function renderOverviewCharts() {
      const brands = DATA.brands;
      const colors = brands.map(b => DATA.brand_colors[b]);

      // 1) ë¸Œëœë“œë³„ ë§¤ì¥ ìˆ˜
      new Chart(document.getElementById('chartBrandCount'), {
        type: 'bar',
        data: {
          labels: brands,
          datasets: [{
            data: brands.map(b => DATA.brand_stats[b].total_stores),
            backgroundColor: colors,
            borderRadius: 6,
          }]
        },
        options: chartOpts('ë§¤ì¥ ìˆ˜')
      });

      // 2) ë¸Œëœë“œë³„ ì§„ì¶œ í–‰ì •ë™ ìˆ˜
      new Chart(document.getElementById('chartDongCount'), {
        type: 'doughnut',
        data: {
          labels: brands,
          datasets: [{
            data: brands.map(b => DATA.brand_stats[b].dong_count),
            backgroundColor: colors,
            borderWidth: 0,
            hoverOffset: 8,
          }]
        },
        options: {
          responsive: true, maintainAspectRatio: false,
          plugins: {
            legend: { position: 'right', labels: { color: '#8b949e', font: { size: 11 } } },
            tooltip: { callbacks: { label: ctx => ` ${ctx.label}: ${ctx.parsed}ê°œ ë™` } }
          }
        }
      });

      // 3) ìƒìœ„ 30ê°œ ë™ ë¸Œëœë“œ ë¶„í¬ (ëˆ„ì  ë§‰ëŒ€)
      const sorted = [...DATA.dong_data]
        .filter(d => d.total_brand_count > 0)
        .sort((a, b) => b.total_brand_count - a.total_brand_count)
        .slice(0, 30);

      new Chart(document.getElementById('chartTopDong'), {
        type: 'bar',
        data: {
          labels: sorted.map(d => d.dong_name),
          datasets: brands.map((brand, i) => ({
            label: brand,
            data: sorted.map(d => d.brands[brand] || 0),
            backgroundColor: colors[i],
            borderRadius: i === brands.length - 1 ? { topLeft: 4, topRight: 4 } : 0,
          }))
        },
        options: {
          ...chartOpts('ë§¤ì¥ ìˆ˜'),
          scales: {
            x: {
              stacked: true,
              ticks: { color: '#8b949e', font: { size: 9 }, maxRotation: 45 },
              grid: { color: '#21262d' }
            },
            y: { stacked: true, ticks: { color: '#8b949e' }, grid: { color: '#21262d' } }
          },
          plugins: {
            legend: { position: 'top', labels: { color: '#8b949e', font: { size: 11 } } },
            tooltip: { mode: 'index' }
          }
        }
      });

      // 4) ì—°ë ¹ëŒ€ë³„ ë§¤ì¶œ í•©ê³„
      const ageCols = ['age_10', 'age_20', 'age_30', 'age_40', 'age_50', 'age_60'];
      const ageLabels = ['10ëŒ€', '20ëŒ€', '30ëŒ€', '40ëŒ€', '50ëŒ€', '60ëŒ€+'];
      const ageTotals = ageCols.map(k =>
        DATA.dong_data.reduce((s, d) => s + (d[k] || 0), 0) / 1e8
      );

      new Chart(document.getElementById('chartAge'), {
        type: 'bar',
        data: {
          labels: ageLabels,
          datasets: [{
            data: ageTotals,
            backgroundColor: ['#FF6B6B', '#FFE66D', '#4ECDC4', '#58a6ff', '#bc8cff', '#A8E6CF'],
            borderRadius: 6,
          }]
        },
        options: chartOpts('ë§¤ì¶œ(ì–µì›)')
      });
    }

    function chartOpts(yLabel) {
      return {
        responsive: true, maintainAspectRatio: false,
        plugins: {
          legend: { display: false },
          tooltip: { backgroundColor: '#21262d', titleColor: '#e6edf3', bodyColor: '#8b949e' }
        },
        scales: {
          x: { ticks: { color: '#8b949e', font: { size: 10 } }, grid: { color: '#21262d' } },
          y: { ticks: { color: '#8b949e' }, grid: { color: '#21262d' } }
        }
      };
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  ì§€ë„ ì´ˆê¸°í™”
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function initMap() {
      leafletMap = L.map('map').setView([37.5665, 126.9780], 11);
      L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
        attribution: 'Â© OpenStreetMap Â© CARTO', maxZoom: 19
      }).addTo(leafletMap);

      DATA.brands.forEach(brand => {
        activeFilters.add(brand);
        markerLayers[brand] = L.layerGroup().addTo(leafletMap);
      });

      DATA.map_points.forEach(pt => {
        const color = DATA.brand_colors[pt.brand] || '#888';
        const marker = L.circleMarker([pt.lat, pt.lng], {
          radius: 6, fillColor: color, color: '#fff',
          weight: 1.5, opacity: 1, fillOpacity: 0.85
        }).bindPopup(`
      <div style="font-family:'Noto Sans KR',sans-serif;min-width:140px">
        <div style="font-weight:700;color:${color};margin-bottom:4px">${pt.brand}</div>
        <div style="font-size:.85rem">${pt.name}</div>
      </div>
    `);
        markerLayers[pt.brand].addLayer(marker);
      });

      updateMapStats();
    }

    function setupBrandFilters() {
      const container = document.getElementById('brandFilters');
      container.innerHTML = DATA.brands.map(brand => {
        const color = DATA.brand_colors[brand];
        const cnt = DATA.brand_stats[brand].map_count;
        return `
      <button class="brand-filter-btn active" data-brand="${brand}"
        style="color:${color}" onclick="toggleBrandFilter('${brand}', this)">
        <span class="dot" style="background:${color}"></span>
        ${brand}
        <span class="count">${cnt}</span>
      </button>
    `;
      }).join('');
    }

    function toggleBrandFilter(brand, btn) {
      if (activeFilters.has(brand)) {
        activeFilters.delete(brand);
        btn.classList.remove('active');
        btn.style.opacity = '0.4';
        if (leafletMap && markerLayers[brand]) leafletMap.removeLayer(markerLayers[brand]);
      } else {
        activeFilters.add(brand);
        btn.classList.add('active');
        btn.style.opacity = '1';
        if (leafletMap && markerLayers[brand]) markerLayers[brand].addTo(leafletMap);
      }
      updateMapStats();
    }

    function updateMapStats() {
      const visible = [...activeFilters].reduce((s, b) => s + (DATA.brand_stats[b]?.map_count || 0), 0);
      document.getElementById('mapStats').innerHTML =
        `í‘œì‹œ ì¤‘: <strong style="color:var(--text)">${visible.toLocaleString()}</strong>ê°œ ë§¤ì¥`;
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  í–‰ì •ë™ í…Œì´ë¸”
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    let dongSortKey = 'total_brand_count';
    let dongSortAsc = false;

    function renderDongTable() {
      // ë¸Œëœë“œ í•„í„° ì˜µì…˜
      const sel = document.getElementById('dongBrandFilter');
      DATA.brands.forEach(b => {
        const opt = document.createElement('option');
        opt.value = b; opt.textContent = b;
        sel.appendChild(opt);
      });

      document.getElementById('dongSearch').addEventListener('input', updateDongTable);
      document.getElementById('dongBrandFilter').addEventListener('change', updateDongTable);
      document.getElementById('dongSortBy').addEventListener('change', e => {
        dongSortKey = e.target.value;
        updateDongTable();
      });

      updateDongTable();
    }

    function updateDongTable() {
      const search = document.getElementById('dongSearch').value.toLowerCase();
      const brandFilter = document.getElementById('dongBrandFilter').value;

      let rows = DATA.dong_data.filter(d => {
        if (search && !d.dong_name.includes(search)) return false;
        if (brandFilter && (d.brands[brandFilter] || 0) === 0) return false;
        return true;
      });

      rows.sort((a, b) => {
        const va = a[dongSortKey] ?? -1;
        const vb = b[dongSortKey] ?? -1;
        return dongSortAsc ? va - vb : vb - va;
      });

      const tbody = document.getElementById('dongTableBody');
      tbody.innerHTML = rows.slice(0, 200).map(d => {
        const score = d.attractiveness_score;
        const scoreBar = score != null
          ? `<div class="score-bar">
           <div class="score-bar-inner" style="width:${Math.min(score, 100)}px"></div>
           <span>${score.toFixed(1)}</span>
         </div>`
          : '-';
        const sales = d.monthly_sales > 0 ? (d.monthly_sales / 1e8).toFixed(1) : '-';
        // í‰ê·  ë§¤ì¶œ: ì›” ë§¤ì¶œ / ì¹´í˜ ìˆ˜ (ë§Œì› ë‹¨ìœ„)
        const avgSales = (d.monthly_sales > 0 && d.cafe_count > 0)
          ? Math.round(d.monthly_sales / d.cafe_count / 1e4).toLocaleString()
          : '-';

        return `
      <tr onclick="showDongDetail(${JSON.stringify(d).replace(/"/g, '&quot;')})" style="cursor:pointer">
        <td><strong>${d.dong_name}</strong></td>
        ${DATA.brands.map(b => {
          const cnt = d.brands[b] || 0;
          const color = DATA.brand_colors[b];
          return `<td>${cnt > 0 ? `<span class="brand-pill" style="background:${color}20;color:${color}">${cnt}</span>` : '<span style="color:var(--text-sub)">-</span>'}</td>`;
        }).join('')}
        <td><strong>${d.total_brand_count}</strong></td>
        <td>${scoreBar}</td>
        <td>${sales}</td>
        <td>${avgSales !== '-' ? avgSales + 'ë§Œ' : '-'}</td>
      </tr>
    `;
      }).join('');
    }

    function showDongDetail(d) {
      const detail = document.getElementById('dongDetail');
      const scores = [
        { label: 'ë§¤ë ¥ë„', val: d.attractiveness_score, color: '#58a6ff' },
        { label: 'ìˆ˜ìš”', val: d.demand_score, color: '#4ECDC4' },
        { label: 'ê²½ìŸ', val: d.competition_score, color: '#FFE66D' },
        { label: 'ë¹„ìš©', val: d.cost_score, color: '#A8E6CF' },
      ];

      detail.innerHTML = `
    <h3>${d.dong_name}</h3>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:12px">
      ${scores.map(s => `
        <div style="background:var(--surface2);border-radius:8px;padding:10px">
          <div style="font-size:.7rem;color:var(--text-sub)">${s.label} ì ìˆ˜</div>
          <div style="font-size:1.2rem;font-weight:700;color:${s.color}">${s.val != null ? s.val.toFixed(1) : '-'}</div>
        </div>
      `).join('')}
    </div>
    <div style="font-size:.8rem;color:var(--text-sub);margin-bottom:6px">
      ê·¼ë¡œì: <strong style="color:var(--text)">${d.total_workers.toLocaleString()}</strong>ëª… 
      (ì—¬ì„± ${d.female_workers.toLocaleString()}ëª…)
    </div>
    <div style="font-size:.8rem;color:var(--text-sub);margin-bottom:6px">
      ì›” ë§¤ì¶œ: <strong style="color:var(--text)">${d.monthly_sales > 0 ? (d.monthly_sales / 1e8).toFixed(1) + 'ì–µ' : '-'}</strong>
    </div>
    <div style="font-size:.8rem;color:var(--text-sub);margin-bottom:6px">
      í‰ê·  ë§¤ì¶œ: <strong style="color:#4ECDC4">${(d.monthly_sales > 0 && d.cafe_count > 0) ? Math.round(d.monthly_sales / d.cafe_count / 1e4).toLocaleString() + 'ë§Œì›/ì í¬' : '-'}</strong>
    </div>
    <div style="font-size:.8rem;color:var(--text-sub);margin-bottom:12px">
      ì¹´í˜ ìˆ˜: <strong style="color:var(--text)">${d.cafe_count}</strong>ê°œ
    </div>
    <div style="font-size:.75rem;color:var(--text-sub);margin-bottom:6px">ë¸Œëœë“œ í˜„í™©</div>
    <div style="display:flex;flex-wrap:wrap;gap:4px">
      ${DATA.brands.map(b => {
        const cnt = d.brands[b] || 0;
        const color = DATA.brand_colors[b];
        return `<span class="brand-pill" style="background:${color}${cnt > 0 ? '30' : '10'};color:${cnt > 0 ? color : 'var(--text-sub)'}">${b} ${cnt}</span>`;
      }).join('')}
    </div>
  `;

      // ì—°ë ¹ëŒ€ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
      const ageData = [d.age_10, d.age_20, d.age_30, d.age_40, d.age_50, d.age_60].map(v => (v || 0) / 1e6);
      if (dongAgeChart) dongAgeChart.destroy();
      dongAgeChart = new Chart(document.getElementById('chartDongAge'), {
        type: 'bar',
        data: {
          labels: ['10ëŒ€', '20ëŒ€', '30ëŒ€', '40ëŒ€', '50ëŒ€', '60ëŒ€+'],
          datasets: [{
            data: ageData,
            backgroundColor: ['#FF6B6B', '#FFE66D', '#4ECDC4', '#58a6ff', '#bc8cff', '#A8E6CF'],
            borderRadius: 5,
          }]
        },
        options: {
          ...chartOpts('ë§¤ì¶œ(ë°±ë§Œ)'),
          plugins: { legend: { display: false } }
        }
      });
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  ì…ì§€ ì¶”ì²œ
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function renderRecommend() {
      const sel = document.getElementById('recBrandFilter');
      DATA.brands.forEach(b => {
        const opt = document.createElement('option');
        opt.value = b; opt.textContent = b;
        sel.appendChild(opt);
      });

      document.getElementById('recBrandFilter').addEventListener('change', updateRecommend);
      document.getElementById('recSortFilter').addEventListener('change', updateRecommend);
      document.getElementById('recSearch').addEventListener('input', updateRecommend);

      updateRecommend();
    }

    function updateRecommend() {
      const brandFilter = document.getElementById('recBrandFilter').value;
      const sortKey = document.getElementById('recSortFilter').value;
      const search = document.getElementById('recSearch').value.toLowerCase();

      let items = DATA.recommend_top.filter(r => {
        if (brandFilter && r.brand !== brandFilter) return false;
        if (search && !r.dong_name.includes(search)) return false;
        return true;
      });

      items.sort((a, b) => (b[sortKey] ?? 0) - (a[sortKey] ?? 0));
      document.getElementById('recCount').textContent = `${items.length}ê°œ ê²°ê³¼`;

      const grid = document.getElementById('recommendGrid');
      grid.innerHTML = items.slice(0, 60).map((r, i) => {
        const color = DATA.brand_colors[r.brand];
        const scoreColor = r.attractiveness_score > 60 ? '#4ECDC4' : r.attractiveness_score > 40 ? '#FFE66D' : '#FF6B6B';
        return `
      <div class="rec-card" style="border-top:3px solid ${color}">
        <div class="rec-rank">#${i + 1} ì¶”ì²œ</div>
        <div class="rec-dong">${r.dong_name}</div>
        <div class="rec-brand">
          <span class="brand-pill" style="background:${color}25;color:${color}">${r.brand}</span>
          <span style="font-size:.75rem;color:var(--text-sub);margin-left:4px">ë¯¸ì§„ì¶œ ì§€ì—­</span>
        </div>
        <div class="rec-scores">
          <div class="rec-score-item">
            <div class="label">ë§¤ë ¥ë„ ì ìˆ˜</div>
            <div class="value" style="color:${scoreColor}">${r.attractiveness_score?.toFixed(1) ?? '-'}</div>
          </div>
          <div class="rec-score-item">
            <div class="label">ìˆ˜ìš” ì ìˆ˜</div>
            <div class="value" style="color:#4ECDC4">${r.demand_score?.toFixed(1) ?? '-'}</div>
          </div>
          <div class="rec-score-item">
            <div class="label">ê²½ìŸ ì ìˆ˜</div>
            <div class="value" style="color:#FFE66D">${r.competition_score?.toFixed(1) ?? '-'}</div>
          </div>
          <div class="rec-score-item">
            <div class="label">ë¹„ìš© ì ìˆ˜</div>
            <div class="value" style="color:#A8E6CF">${r.cost_score?.toFixed(1) ?? '-'}</div>
          </div>
        </div>
        <div style="margin-top:10px;font-size:.75rem;color:var(--text-sub)">
          ê·¼ë¡œì ${r.total_workers?.toLocaleString() ?? '-'}ëª… Â· 
          ì¹´í˜ ${r.cafe_count ?? '-'}ê°œ Â· 
          ì›”ë§¤ì¶œ ${r.monthly_sales > 0 ? (r.monthly_sales / 1e8).toFixed(1) + 'ì–µ' : '-'}
        </div>
      </div>
    `;
      }).join('');
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  ì‹œì‘
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    loadData().catch(err => {
      document.querySelector('main').innerHTML = `
    <div class="loading">
      âš ï¸ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ${err.message}<br>
      <small style="margin-top:8px;display:block">preprocess.pyë¥¼ ë¨¼ì € ì‹¤í–‰í•´ì£¼ì„¸ìš”</small>
    </div>
  `;
    });
  </script>
</body>

</html>